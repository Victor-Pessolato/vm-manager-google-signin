<!doctype html>
<html>
<head>
  <title>VMs Manager</title>
  <meta name="google-signin-client_id" content="{{ gsignin_key }}">

  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>VMs Manager</h1>

<div class="g-signin2" data-onsuccess="onSignIn"></div>

<div id="login-info">
  <h2>Login info:</h2>
  {% if user_data %}
    <dl>
      <dt>Name</dt>
      <dd>{{ user_data['name'] }}</dd>
      
      <dt>Email</dt>
      <dd>{{ user_data['email'] }}</dd>
      
      <dt>Last 10 visits</dt>
    </dl>
  {% else %}
    <p>Error: No user data</p>
  {% endif %}
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    function checkLoginUser(id_token) {
        let data = {
            token: id_token
        };        
        $.post("/checktoken", data, function(res) {
            console.log(res);
        });
    }

    function onSignIn(googleUser) {
        let id_token = googleUser.getAuthResponse().id_token;
        checkLoginUser(id_token);
    }

    if (auth2.isSignedIn.get()) {
        let id_token = googleUser.getAuthResponse().id_token;
        checkLoginUser(id_token);
    }
</script>
</body>
</html>
